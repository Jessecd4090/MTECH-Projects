# SwiftData Todo List Lab

## Introduction
This lab is designed to help you learn the basics of SwiftData. You will take this basic todo list (already built) and convert it from using local arrays to SwiftData for persistence. The app at the starting point (main branch) uses in-memory arrays to store todo items, which means data is lost when the app is closed. By converting to SwiftData, we'll add persistence while keeping the app's functionality intact.

## Project Overview
Before diving into SwiftData conversion, let's understand the project structure:
- `TodoItem.swift`: The model representing a todo item
- `TodoItemsView.swift`: The main view displaying todo items
- `TodoItemRow.swift`: A reusable view for displaying individual todo items
- `SwiftDataTodoListApp.swift`: The app's entry point

### Notes before starting
- Start on the `main` branch for this lab
- You'll see some commented out code in `SwiftDataTodoListApp.swift`. This code is boilerplate code generated by Xcode if you create a new project with the SwiftData box checked. So I won't make you write it out. It's also provided in step 2 below

## Step 1: Convert the Model
First, we need to convert our `TodoItem` struct to a SwiftData model:

1. Import SwiftData:
```swift
import SwiftData
```

2. Convert the struct to a class and add the @Model macro:
```swift
@Model
final class TodoItem {
    var id: String
    var title: String
    var createdAt: Date
    var completedAt: Date?
    
    // ... rest of the implementation
}
```

Note: The `Identifiable` and `Equatable` conformances are no longer needed as they're provided by SwiftData.

## Step 2: Set Up the SwiftData Container
In `SwiftDataTodoListApp.swift`, we need to set up the SwiftData container:

1. Import SwiftData
2. Add the model container (or simply uncomment the code):
```swift
let sharedModelContainer: ModelContainer = {
    let schema = Schema([
        TodoItem.self,
    ])
    let modelConfiguration = ModelConfiguration(schema: schema, isStoredInMemoryOnly: false)

    do {
        return try ModelContainer(for: schema, configurations: [modelConfiguration])
    } catch {
        fatalError("Could not create ModelContainer: \(error)")
    }
}()
```

3. Add the container to the app:
```swift
.modelContainer(sharedModelContainer)
```

## Step 3: Update the Main View
In `TodoItemsView.swift`, we need to replace the local array with SwiftData's persistence:

1. Import SwiftData
2. Replace the items array with a @Query:
```swift
@Environment(\.modelContext) private var modelContext
@Query private var items: [TodoItem]
```

3. Update the CRUD operations:

### Creating Items
```swift
func addItem() {
    guard !newItemTitle.isEmpty else { return }
    withAnimation {
        let newItem = TodoItem(title: newItemTitle)
        modelContext.insert(newItem)
        newItemTitle = ""
    }
}
```

### Deleting Items
```swift
func deleteItems(from sectionItems: [TodoItem], at offsets: IndexSet) {
    let itemsToDelete = offsets.map { sectionItems[$0] }
    itemsToDelete.forEach { modelContext.delete($0) }
}
```

### Updating Items
```swift
func toggleCompletion(for item: TodoItem) {
    item.completedAt = item.isCompleted ? nil : Date()
}
```

4. Save the context:

- The model context is like a scratch pad of changes. Only once those changes are saved will the data actually persist
- So make sure to save the modelContext after CRUD operations
- Create a function that saves the current changes on the context:
```swift
    func save() {
        try? modelContext.save()
    }
```
- Then call this function at the end of addItem, deleteItems, toggleCompletion


## Key Differences
1. **Persistence**: Data now persists between app launches
2. **No Manual Array Management**: SwiftData handles the storage and updates automatically
3. **Automatic Updates**: The UI updates automatically when the data changes
4. **Preview Support**: Added `.modelContainer(for: TodoItem.self, inMemory: true)` for previews

## Testing
To verify the conversion:
1. Run the app
2. Add some todo items
3. Complete some items
4. Delete some items
5. Force quit the app and relaunch
6. Verify that your items are still there

## Advanced Testing
1. Download Core Data Lab from the app store (free trial)
1. Make sure you have a simulator with the some items saved
1. Open the simulator in Core Data Lab
1. Inspect the saved elements in the database

## Verification
1. If you must look at the `swift-data-solution` branch as a reference go ahead, but make sure to put the work in yourself to understand the material.
